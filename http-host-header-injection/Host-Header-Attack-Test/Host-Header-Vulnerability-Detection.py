import os
import fileinput
from termcolor import colored
import commands



def MakeCommand(line,domain):
 command = r"""echo "GET %s HTTP/1.1\r\nHost:evil.com\r\n\r\n" |  netcat %s 80 """ % (str(line), str(domain))
 return command




website = raw_input("Enter Site Address : ")

if  '//' in website:
 domain = website.split("//")
 domain = domain[1]
else:
 domain = website
 website = 'http://' + website 
if (not os.path.isfile('results/'  + str(domain) + '.txt')):
 os.mknod('results/'  + str(domain) + '.txt')
print "web crawling start ..."
os.system('python  crawler.py -d 20 -l ' + str(website)  +  ' > sitepath.txt')
print "web crawling end ..."

for line in fileinput.input(['sitepath.txt']):
 line = line.strip()
 line = line.split(" ")
 line = line[1]
 command =  MakeCommand(line, domain)
 x= commands.getstatusoutput(command)
 if "evil.com" in x[1]:
  print colored('[-] '+str(line) + ' ---->  vulnerable', 'red')
  with open('results/'  + str(domain) + '.txt', "a") as myfile:
    myfile.write(str(line)+'\n')
 else:
  print colored('[+] '+str(line), 'green')
 
for line in fileinput.input(['mycrawler.txt']):
 line = line.strip()
 command =  MakeCommand(line, domain)
 x= commands.getstatusoutput(command)
 if "evil.com" in x[1]:
  print colored('[-] '+str(line) + ' ---->  vulnerable', 'red')
  with open('results/'  + str(domain) + '.txt', "a") as myfile:
    myfile.write(str(line)+'\n')
 else:
  print colored('[+] '+str(line), 'green')
print 'save in results/'  + str(domain) + '.txt' 
